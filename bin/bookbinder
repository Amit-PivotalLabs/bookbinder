#!/usr/bin/env ruby

require 'bookbinder'

usage_message = 'usage: publish <local|github>'

unless ARGV.size == 1
  puts usage_message
  exit
end

unless %w(local github).include?(ARGV[0])
  puts usage_message
  exit
end

local_repo_dir = (ARGV[0] == 'local') ? File.absolute_path('../') : nil

config = YAML.load File.read('./config.yml')
repos = config['repos']

# TODO: general solution to turn all string keys to symbols
pdf_hash = config['pdf'] ? {page: config['pdf']['page'], filename: config['pdf']['filename']} : nil

publisher = Publisher.new
success = publisher.publish repos: repos,
                            output_dir: File.absolute_path('output'),
                            master_middleman_dir: File.absolute_path('master_middleman'),
                            local_repo_dir: local_repo_dir,
                            final_app_dir: File.absolute_path('final_app'),
                            github_username: config['github_username'],
                            github_password: config['github_password'],
                            pdf: pdf_hash

exit success ? 0 : 1